{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" type="image/png" href="{% static 'ahanalogo.png' %}" />
  <link rel="stylesheet" href="{% static 'style.css' %}">
  <title>Screen Sharing</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      text-align: center; 
      padding: 20px; 
      margin: 0; 
      background-color: #121212; /* dark background */
      color: #f5f5f5;
    }
    .container { 
      max-width: 900px; 
      margin: 0 auto; 
      padding: 20px; 
      background-color: #1c1c1c; /* dark gray container */
      border-radius: 25px; 
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); 
    }
    h1 { 
      font-size: 28px; 
      margin: 20px 0; 
      color: #00ced1; /* turquoise */
    }
    @media (max-width:600px){ 
      h1 { font-size:24px; } 
    }
    #screenshot { 
      max-width:100%; 
      margin:20px auto; 
      border:2px solid #555; 
      border-radius:12px; 
      box-shadow:0 3px 6px rgba(0,0,0,0.5); 
    }
    .button-container { 
      display: flex; 
      justify-content: center; 
      gap: 15px; 
      flex-wrap: wrap; 
      margin: 15px 0; 
    }
    .button { 
      padding: 12px 25px; 
      font-size: 18px; 
      cursor: pointer; 
      border: none; 
      border-radius: 30px; 
      transition: all 0.3s ease; 
      min-width: 140px; 
      color: #ffffff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    #start { 
      background-color: #00796b; /* teal */
    }
    #stop { 
      background-color: #d32f2f; /* red */
    }
    #start:hover, #start:active { 
      background-color: #004d40; 
      color: #ffffff;
    }
    #stop:hover, #stop:active { 
      background-color: #f44336; 
      color: #ffffff;
    }
    #status, #processing-status { 
      margin: 15px 0; 
      padding: 12px; 
      border-radius: 12px; 
      background-color: #333; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.5); 
      color: #f5f5f5;
    }
    #status { 
      font-weight: bold; 
      color: #00ced1; /* turquoise */
    }
    #processing-status { 
      color: #e0e0e0; 
      font-style: italic; 
    }
    .device-type { 
      margin: 15px 0; 
      padding: 12px; 
      background-color: #444; 
      border-radius: 12px; 
      font-size: 16px; 
      color: #ffffff;
    }
    .instructions { 
      margin: 20px 0; 
      padding: 20px; 
      background-color: #333; 
      border-radius: 12px; 
      text-align: left; 
      font-size: 16px; 
      color: #ffffff;
    }
    .instructions h3 { 
      margin-top: 0; 
      color: #ffa500; /* orange */
    }
    .instructions ul { 
      margin: 0; 
      padding-left: 20px; 
    }
    .instructions li { 
      margin: 8px 0; 
    }
    #chatContainer { 
      margin-top: 20px; 
      text-align: left; 
      max-height: 350px; 
      overflow-y: auto; 
      padding: 15px; 
      border-radius: 15px; 
      background-color: #222; 
      color: #ffffff;
    }
    .chat-message { 
      margin: 8px 0; 
      padding: 10px 15px; 
      border-radius: 15px; 
      max-width: 75%; 
    }
    .user-message { 
      background-color: #004d40; /* dark green teal */
      align-self: flex-start; 
      color: #ffffff;
    }
    .ai-message { 
      background-color: #ff9800; /* orange */
      align-self: flex-end; 
      text-align: right; 
      color: #ffffff;
    }
    #chatContainer .message-wrapper { 
      display: flex; 
      flex-direction: column; 
    }
    /* Position video off-screen while keeping the stream active */
    #video { 
      position: absolute; 
      top: -9999px; 
      left: -9999px; 
      width: 1px; 
      height: 1px; 
    }
    img { 
      height: 80px; 
      width: auto; 
    }
    #mobile-help { 
      margin: 15px 0; 
      padding: 20px; 
      background-color: #800080; /* purple */
      border-radius: 12px; 
      display: none; 
      color: #ffffff;
    }
    #mobile-help h3 { 
      margin-top: 0; 
      color: #ecf0f1; 
    }
    .compatibility-notice { 
      font-weight: bold; 
      color: #ffffff; 
      margin: 8px 0; 
    }
    #audioFallbackBtn { 
      display: none; 
      margin: 15px auto; 
      padding: 10px 20px; 
      background-color: #ffffff; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      color: #000000;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Screen Sharing</h1>
    <div class="device-type" id="deviceType">Detecting device type...</div>
    <div class="instructions">
      <h3>Instructions:</h3>
      <ul id="deviceInstructions"></ul>
    </div>
    <div id="mobile-help">
      <h3>Mobile Screen Sharing Help</h3>
      <div id="mobile-help-content"></div>
      <button id="audioFallbackBtn">Use Audio Only Mode</button>
    </div>
    <div class="button-container">
      <button id="start" class="button">Start Screen Sharing</button>
      <button id="stop" class="button">Stop Sharing</button>
    </div>
    <div id="status">Status: Not sharing</div>
    <div id="processing-status">Ready to start</div>
    <div id="chatContainer"></div>
    <!-- Video element is positioned off-screen -->
    <video id="video" playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <img id="screenshot" alt="Screen share" aria-live="polite" />
  </div>

  <script>
    let isSharing = false;
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const screenshot = document.getElementById('screenshot');
    const startBtn = document.getElementById('start');
    const stopBtn = document.getElementById('stop');
    const statusDiv = document.getElementById('status');
    const processingStatus = document.getElementById('processing-status');
    const deviceTypeDiv = document.getElementById('deviceType');
    const deviceInstructions = document.getElementById('deviceInstructions');
    const chatContainer = document.getElementById('chatContainer');
    const mobileHelp = document.getElementById('mobile-help');
    const mobileHelpContent = document.getElementById('mobile-help-content');
    const audioFallbackBtn = document.getElementById('audioFallbackBtn');

    // Browser and device detection
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    const isAndroid = /Android/i.test(navigator.userAgent);
    const isSamsung = /SamsungBrowser/i.test(navigator.userAgent);
    const isChrome = /Chrome/i.test(navigator.userAgent) && !/Edge|Edg/i.test(navigator.userAgent);
    const isSafari = /Safari/i.test(navigator.userAgent) && !/Chrome/i.test(navigator.userAgent);
    const isFirefox = /Firefox/i.test(navigator.userAgent);

    // Video sharing functions
    async function startSharing() {
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        video.srcObject = stream;
        video.play();
        startBtn.disabled = true;
        stopBtn.disabled = false;
        isSharing = true;
        statusDiv.innerText = "Status: Sharing in progress";
        processingStatus.innerText = "Capturing screen...";
      } catch (error) {
        console.error("Error starting screen sharing: ", error);
        statusDiv.innerText = "Status: Error starting screen share";
      }
    }

    function stopSharing() {
      const stream = video.srcObject;
      const tracks = stream.getTracks();
      tracks.forEach(track => track.stop());
      video.srcObject = null;
      startBtn.disabled = false;
      stopBtn.disabled = true;
      isSharing = false;
      statusDiv.innerText = "Status: Not sharing";
      processingStatus.innerText = "Ready to start";
    }

    startBtn.addEventListener('click', startSharing);
    stopBtn.addEventListener('click', stopSharing);
  </script>
     <script src="{% static 'script.js' %}"></script>
</body>
</html>
